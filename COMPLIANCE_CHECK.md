# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫–µ–Ω–¥–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram

## üìã –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

1. **–ü–æ–ª—É—á–∏—Ç—å `initData` —Å—Ç—Ä–æ–∫—É** –æ—Ç Telegram WebApp SDK
2. **–ò–∑–≤–ª–µ—á—å –ø–∞—Ä–∞–º–µ—Ç—Ä `hash`** –∏–∑ —Å—Ç—Ä–æ–∫–∏
3. **–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `check_string`**:
   - –í–∑—è—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–æ–º–µ `hash`
   - –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –∫–ª—é—á–∞–º –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ —Å—Ç—Ä–æ–∫—É —Ñ–æ—Ä–º–∞—Ç–∞: `key=value\nkey=value`
4. **–í—ã—á–∏—Å–ª–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á**: `HMAC-SHA256(key="WebAppData", message=bot_token)`
5. **–í—ã—á–∏—Å–ª–∏—Ç—å HMAC**: `HMAC-SHA256(key=secret_key, message=check_string)`
6. **–°—Ä–∞–≤–Ω–∏—Ç—å** `computed_hash` —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º `hash`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `verify_telegram_auth_from_init_data`:

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å `initData` —Å—Ç—Ä–æ–∫—É

- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `init_data: &str` (—Å—Ç—Ä–æ–∫–∞ 67)
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

### –®–∞–≥ 2: –ò–∑–≤–ª–µ—á—å –ø–∞—Ä–∞–º–µ—Ç—Ä `hash`

- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 78-88 - –ø–∞—Ä—Å–∏–º initData –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º hash
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

### –®–∞–≥ 3: –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `check_string`

- ‚úÖ **–í–∑—è—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–æ–º–µ `hash`:** –°—Ç—Ä–æ–∫–∏ 78-86 - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–æ–º–µ hash
- ‚úÖ **–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–ª—é—á–∞–º:** –°—Ç—Ä–æ–∫–∞ 102 - `params.sort_by(|a, b| a.0.cmp(b.0))`
- ‚úÖ **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ —Å—Ç—Ä–æ–∫—É:** –°—Ç—Ä–æ–∫–∏ 108-114 - `check_string_parts.join("\n")`
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

### –®–∞–≥ 4: –í—ã—á–∏—Å–ª–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á

- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 121-124
  ```rust
  let mut mac_key = Hmac::<Sha256>::new_from_slice(b"WebAppData")
  mac_key.update(bot_token.as_bytes());
  let secret_key = mac_key.finalize().into_bytes();
  ```
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `HMAC-SHA256(key="WebAppData", message=bot_token)`

### –®–∞–≥ 5: –í—ã—á–∏—Å–ª–∏—Ç—å HMAC

- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 129-134
  ```rust
  let mut mac = Hmac::<Sha256>::new_from_slice(&secret_key)
  mac.update(check_string.as_bytes());
  let result = mac.finalize().into_bytes();
  let computed_hash = hex::encode(result);
  ```
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `HMAC-SHA256(key=secret_key, message=check_string)`

### –®–∞–≥ 6: –°—Ä–∞–≤–Ω–∏—Ç—å hash

- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∞ 139 - `computed_hash != received_hash`
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢:

### –§—É–Ω–∫—Ü–∏—è `verify_telegram_auth_from_init_data`:

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram

### –§—É–Ω–∫—Ü–∏—è `verify_telegram_auth` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç):

**‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –∫–æ–≥–¥–∞ Flutter –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `initData`. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç JSON, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –ø–æ—Ä—è–¥–∫–æ–º –∫–ª—é—á–µ–π. –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Flutter.

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `verify_telegram_auth_from_init_data`** - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±
2. ‚ö†Ô∏è **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Flutter** - —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É `initData`
3. ‚úÖ **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Flutter** - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `verify_telegram_auth` –∏ –ª–æ–≥–∏–∫—É —Å –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –∫–ª—é—á–µ–π

## üéØ –í—ã–≤–æ–¥:

**–ë—ç–∫–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram**, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å `initData`. –§—É–Ω–∫—Ü–∏—è `verify_telegram_auth_from_init_data` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–æ—á–Ω–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
